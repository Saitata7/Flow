{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "User Settings Schema v2",
  "description": "Restructured schema for user settings data in the Flow app",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique identifier for the settings"
    },
    "userId": {
      "type": "string",
      "description": "ID of the user these settings belong to"
    },
    "uiPreferences": {
      "type": "object",
      "properties": {
        "theme": {
          "type": "string",
          "enum": ["light", "dark", "auto"],
          "description": "App theme preference"
        },
        "accentColor": {
          "type": "string",
          "pattern": "^#[0-9A-Fa-f]{6}$",
          "description": "Accent color in hex format"
        },
        "textSize": {
          "type": "string",
          "enum": ["small", "medium", "large"],
          "description": "Text size preference"
        },
        "highContrast": {
          "type": "boolean",
          "description": "High contrast mode enabled"
        },
        "defaultLandingPage": {
          "type": "string",
          "enum": ["dashboard", "today", "stats"],
          "description": "Default landing page"
        }
      },
      "required": ["theme", "accentColor", "textSize", "highContrast", "defaultLandingPage"],
      "additionalProperties": false
    },
    "reminders": {
      "type": "object",
      "properties": {
        "dailyReminders": {
          "type": "boolean",
          "description": "Daily reminder notifications"
        },
        "weeklyReports": {
          "type": "boolean",
          "description": "Weekly report notifications"
        },
        "achievementAlerts": {
          "type": "boolean",
          "description": "Achievement alert notifications"
        },
        "communityUpdates": {
          "type": "boolean",
          "description": "Community update notifications"
        },
        "reminderTime": {
          "type": "string",
          "pattern": "^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$",
          "description": "Reminder time in HH:MM format"
        },
        "quietHours": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Quiet hours enabled"
            },
            "start": {
              "type": "string",
              "pattern": "^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$",
              "description": "Quiet hours start time"
            },
            "end": {
              "type": "string",
              "pattern": "^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$",
              "description": "Quiet hours end time"
            }
          },
          "required": ["enabled", "start", "end"],
          "additionalProperties": false
        }
      },
      "required": ["dailyReminders", "weeklyReports", "achievementAlerts", "communityUpdates", "reminderTime", "quietHours"],
      "additionalProperties": false
    },
    "privacy": {
      "type": "object",
      "properties": {
        "profileVisibility": {
          "type": "string",
          "enum": ["private", "friends", "public"],
          "description": "Profile visibility level"
        },
        "shareStats": {
          "type": "boolean",
          "description": "Share statistics with others"
        },
        "shareAchievements": {
          "type": "boolean",
          "description": "Share achievements with others"
        },
        "allowFriendRequests": {
          "type": "boolean",
          "description": "Allow friend requests"
        },
        "showOnlineStatus": {
          "type": "boolean",
          "description": "Show online status"
        },
        "location": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Location services enabled"
            },
            "precision": {
              "type": "string",
              "enum": ["city", "neighborhood", "exact"],
              "description": "Location precision level"
            },
            "shareLocation": {
              "type": "boolean",
              "description": "Share location with others"
            }
          },
          "required": ["enabled", "precision", "shareLocation"],
          "additionalProperties": false
        }
      },
      "required": ["profileVisibility", "shareStats", "shareAchievements", "allowFriendRequests", "showOnlineStatus", "location"],
      "additionalProperties": false
    },
    "integrations": {
      "type": "object",
      "properties": {
        "wearables": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Connected wearable devices"
        },
        "externalApps": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Connected external apps"
        },
        "social": {
          "type": "object",
          "properties": {
            "shareProgress": {
              "type": "boolean",
              "description": "Share progress with others"
            },
            "communityChallenges": {
              "type": "boolean",
              "description": "Participate in community challenges"
            },
            "peerEncouragement": {
              "type": "boolean",
              "description": "Receive peer encouragement"
            }
          },
          "required": ["shareProgress", "communityChallenges", "peerEncouragement"],
          "additionalProperties": false
        }
      },
      "required": ["wearables", "externalApps", "social"],
      "additionalProperties": false
    },
    "analyticsConsent": {
      "type": "object",
      "properties": {
        "usageAnalytics": {
          "type": "boolean",
          "description": "Allow usage analytics collection"
        },
        "crashReporting": {
          "type": "boolean",
          "description": "Allow crash reporting"
        },
        "performanceMetrics": {
          "type": "boolean",
          "description": "Allow performance metrics collection"
        },
        "personalizedInsights": {
          "type": "boolean",
          "description": "Allow personalized insights based on data"
        }
      },
      "required": ["usageAnalytics", "crashReporting", "performanceMetrics", "personalizedInsights"],
      "additionalProperties": false
    },
    "backupSettings": {
      "type": "object",
      "properties": {
        "backupFrequency": {
          "type": "string",
          "enum": ["daily", "weekly", "manual"],
          "description": "How often to backup data"
        },
        "cloudBackup": {
          "type": "boolean",
          "description": "Enable cloud backup"
        },
        "localBackup": {
          "type": "boolean",
          "description": "Enable local backup"
        },
        "exportFormat": {
          "type": "string",
          "enum": ["csv", "json", "pdf"],
          "description": "Preferred export format"
        },
        "dataRetention": {
          "type": "string",
          "enum": ["1month", "3months", "6months", "1year", "forever"],
          "description": "How long to keep logs and data"
        },
        "autoExport": {
          "type": "boolean",
          "description": "Automatically export data periodically"
        }
      },
      "required": ["backupFrequency", "cloudBackup", "localBackup", "exportFormat", "dataRetention", "autoExport"],
      "additionalProperties": false
    },
    "flowDefaults": {
      "type": "object",
      "properties": {
        "cheatMode": {
          "type": "boolean",
          "description": "Cheat mode enabled for testing"
        },
        "highlightDayStreak": {
          "type": "boolean",
          "description": "Highlight day streak achievements"
        },
        "closeTime": {
          "type": "string",
          "pattern": "^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$",
          "description": "Daily close time in HH:MM format"
        },
        "type": {
          "type": "string",
          "enum": ["binary", "quantitative", "time-based"],
          "description": "Default flow type"
        },
        "goalFrequency": {
          "type": "string",
          "enum": ["daily", "weekly", "custom"],
          "description": "Default goal frequency"
        },
        "repeatTimesPerWeek": {
          "type": "integer",
          "minimum": 1,
          "maximum": 7,
          "description": "Default repeat times per week"
        },
        "reminderMethod": {
          "type": "string",
          "enum": ["notification", "none"],
          "description": "Default reminder method"
        }
      },
      "required": ["cheatMode", "highlightDayStreak", "closeTime", "type", "goalFrequency", "repeatTimesPerWeek", "reminderMethod"],
      "additionalProperties": false
    },
    "scoring": {
      "type": "object",
      "properties": {
        "showDetailedStats": {
          "type": "boolean",
          "description": "Show detailed statistics"
        },
        "showEmotionNotes": {
          "type": "boolean",
          "description": "Show emotion and notes"
        },
        "motivationalInsights": {
          "type": "boolean",
          "description": "Show motivational insights"
        }
      },
      "required": ["showDetailedStats", "showEmotionNotes", "motivationalInsights"],
      "additionalProperties": false
    },
    "emotionalLogging": {
      "type": "object",
      "properties": {
        "promptFrequency": {
          "type": "string",
          "enum": ["always", "fail/skip", "manual"],
          "description": "When to prompt for emotions"
        },
        "customEmotions": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Custom emotion options"
        }
      },
      "required": ["promptFrequency", "customEmotions"],
      "additionalProperties": false
    },
    "clinician": {
      "type": "object",
      "properties": {
        "enableDashboard": {
          "type": "boolean",
          "description": "Enable clinician dashboard"
        },
        "sharedData": {
          "type": "string",
          "enum": ["stats", "stats+notes"],
          "description": "Type of data to share"
        },
        "clinicians": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of authorized clinicians"
        },
        "clinicianConsent": {
          "type": "boolean",
          "description": "Consent to share with clinicians"
        }
      },
      "required": ["enableDashboard", "sharedData", "clinicians", "clinicianConsent"],
      "additionalProperties": false
    },
    "profile": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "maxLength": 50,
          "description": "User's full name"
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "User's email address"
        },
        "profilePicture": {
          "type": "string",
          "format": "uri",
          "description": "URL to profile picture"
        },
        "timeZone": {
          "type": "string",
          "description": "User's timezone"
        },
        "language": {
          "type": "string",
          "enum": ["en", "es", "fr"],
          "description": "Preferred language"
        }
      },
      "additionalProperties": false
    },
    "schemaVersion": {
      "type": "integer",
      "description": "Schema version for migration purposes"
    },
    "createdAt": {
      "type": "string",
      "format": "date-time",
      "description": "Settings creation timestamp"
    },
    "updatedAt": {
      "type": "string",
      "format": "date-time",
      "description": "Settings last update timestamp"
    },
    "deletedAt": {
      "type": ["string", "null"],
      "format": "date-time",
      "description": "When the settings were soft-deleted (null if not deleted)"
    }
  },
  "required": [
    "id",
    "userId",
    "uiPreferences",
    "reminders",
    "privacy",
    "integrations",
    "analyticsConsent",
    "backupSettings",
    "flowDefaults",
    "scoring",
    "emotionalLogging",
    "clinician",
    "profile",
    "schemaVersion",
    "createdAt",
    "updatedAt"
  ],
  "additionalProperties": false
}